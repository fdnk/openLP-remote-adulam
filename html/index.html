<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <!--
###############################################################################
# OpenLP - Open Source Lyrics Projection                                      #
# --------------------------------------------------------------------------- #
# Copyright (c) 2008-2017 OpenLP Developers                                   #
# --------------------------------------------------------------------------- #
# This program is free software; you can redistribute it and/or modify it     #
# under the terms of the GNU General Public License as published by the Free  #
# Software Foundation; version 2 of the License.                              #
#                                                                             #
# This program is distributed in the hope that it will be useful, but WITHOUT #
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or       #
# FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for    #
# more details.                                                               #
#                                                                             #
# You should have received a copy of the GNU General Public License along     #
# with this program; if not, write to the Free Software Foundation, Inc., 59  #
# Temple Place, Suite 330, Boston, MA 02111-1307 USA                          #
###############################################################################
-->

  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1" />
  <title>${app_title}</title>
  <link rel="stylesheet" href="/files/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="/files/css/custom.css"/>
  <script src="/files/js/jquery-3.3.1.min.js"></script>
  <script src="/files/js/popper.min.js"></script>
  <script src="/files/js/bootstrap.min.js"></script>


  <!-- bootstrap-select -->
  <link rel="stylesheet" href="/files/css/bootstrap-select.min.css">
  <script src="/files/js/bootstrap-select.min.js"></script>
  <script src="/files/js/i18n/defaults-es_ES.min.js"></script>


  <link rel="stylesheet" href="/files/css/remote.css"/>
  <script src="/files/js/commonlib.js"></script>
  <script src="/files/js/biblesearch.js"></script>
  <script src="/files/js/songsearch.js"></script>
  <script src="/files/js/remote.js"></script>
  <script src="/files/js/openlpcontrol.js"></script>

  <link rel="icon" type="image/png" sizes="192x192"  href="/files/images/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/files/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/files/images/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/files/images/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/files/images/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="/files/manifest.json">
  <meta name="mobile-web-app-capable" content="yes">

</head>
<body>
  <nav class="navbar sticky-top navbar-expand-sm navbar-light bg-light justify-content-between">
    <!-- song search bar -->
    <form id="searchForm" class="form-inline">
        <div class="input-group">
  		  <input id="searchText" type="text" class="form-control" placeholder="Buscar una canción" aria-label="Canción a buscar" aria-describedby="basic-addon2">
  		  <div class="input-group-append">
  			<button class="btn btn-outline-success" type="submit">></button>
        <button class="btn btn-danger" type="button" id="cancelSearch" style="display: none;">Borrar</button>
        <button class="btn btn-outline-warning" type="button" id="setIMGbutton">Imagen</button>
  		  </div>
  	 </div>
    </form>

    <!-- options menu -->
    <div class="navbar-nav dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Opciones
      </button>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
        <button type="button" class="btn btn-outline-default btn-circle"><img class="img-circle" src="files/img/note.png"/></button>
        <button type="button" class="btn btn-outline-default btn-circle"><img class="img-circle" src="files/img/fav.png"/></button>
        <button id="bibleModalButton" type="button" class="btn btn-outline-default btn-circle loader" disabled>
           <div id="bibleModalButtonLoader" class="">
             <img class="img-circle" src="files/img/bible.png"/>
           </div>
        </button>

        <a class="dropdown-item" href="#" onclick="SongSearch.update()">Actualizar</a>
      </div>
    </div>
  </nav>

  <!-- Accordion (song preview) -->
  <div class="accordion" id="accordion"></div>

  <!-- Slide item selector -->
  <div id="songPanel" class="text-center h3">
    <ul class="list-group">
    </ul>
  </div>

  <!-- Modal Song Lib Update -->
  <div class="modal fade" id="updatingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Actualizando Canciones</h5>
        </div>
        <div class="modal-body">
          Esto puede tardar un cachito...
          <div class="progress">
            <div id="updateProgess" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bible selector modal -->
  <div class="modal fade" id="bibleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">

        <div class="modal-header">
          <div class="bible-buttons">
            <select class="selectpicker show-tick bookSelector" data-live-search="true" data-style="btn-primary" title="Seleccione un libro">
              <option class="option"> 1 </option>
            </select>
            <select class="selectpicker show-tick chapterSelector" data-live-search="true" data-style=" btn-secondary" title="Cap" data-width="100px">
              <option class="option"> 1 </option>
            </select>
            <select class="selectpicker show-tick verseSelector" data-live-search="true" data-style=" btn-secondary" title="Vers" data-width="100px">
              <option class="option"> 1 </option>
            </select>
          </div>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
            <div id="bibleModal-panel" class="text-left">
              <ul class="list-group">
                <li class="list-group-item active">Coso</li>
                <li class="list-group-item">Coso 2</li>
              </ul>
            </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary mr-auto">&laquo; Anterior</button>
          <button type="button" class="btn btn-secondary">Siguiente &raquo;</button>
        </div>

      </div>
    </div>
  </div>


  <!-- DOM listeners and stuff -->
  <script>
    setInterval(Remote.updateDOM, 1000);
    //****************** Envents ******************
    $(function() {
      // Handler for .ready() called.
      var k = SongSearch.fetch_local_data();

      console.log("Songs Loaded: "+k);
      // clean
      Remote.cancelSearch();

      // Load Bibles database
      /*window.setTimeout(function(){
        BibleSearch.init(function(){
          console.log("Bible Ready");
          Remote.loadBibleData();
          $("#bibleModalButton").prop("disabled", false);
          $("#bibleModalButton").click(function(){
            $('#bibleModal').modal(focus);
          });

        }, function(p){
          console.log("Bible testing PROGRESS: "+Math.round(100*p)+"%");
        });
      },1000); // Delay */

      /*BibleSearch.init(function(res){
        console.log("BibleSearch status: " + res.status);
      });*/

      // Modal triggers
      $("#bibleModal").on('show.bs.modal', function(){
        Remote.bibleModalShowTrigger();
      });
    });

    $("#searchBookForm").submit(function(event){
      event.preventDefault();
    });

    $("#searchForm").submit(function( event ) {
      event.preventDefault();
      Remote.goSearch();
    });
    $("#searchText").keyup(function(){
      Remote.goSearch();
      $("#cancelSearch").toggle($("#searchText").val()?true:false);
    });
    $("#cancelSearch").click(Remote.cancelSearch); //?

    $("#setIMGbutton").click(function(){
      var id = 0
      var text = "{\"request\": {\"id\": " + id + "}}";
      $.getJSON("/api/service/set",{"data": text});
    });

    $("#searchBook").keyup(function(){
      Remote.filterBibleBooks($("#searchBook").val());
      //$("#cancelBookSearch").toggle($("#searchText").val()?true:false);
    });

    // Bible Modal Hooks
    $(".selectpicker.bookSelector").on("changed.bs.select", BibleSelector.selectBookEvent);
    $(".selectpicker.chapterSelector").on("changed.bs.select", BibleSelector.selectChapterEvent);
    $(".selectpicker.verseSelector").on("changed.bs.select", BibleSelector.selectVerseEvent);

    $("#bibleModalButton").prop("disabled", false);
    $("#bibleModalButton").click(function(){
      $('#bibleModal').modal(focus);
    });
    BibleSelector.init(); // I must check if bible DB is downloaded before doing this
  </script>
</body>
</html>
